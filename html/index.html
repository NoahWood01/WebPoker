<!doctype html>
<html>
<meta charset="utf-8">

<head>
  <title>WebPoker Group 5</title>
  <link rel="stylesheet" href="page_style.css">
</head>

<body>
  <p> Welcome to WebPoker with Group 5 of CSE3310.</p>
  <p>message: <input id="send_text" type="text">
    <input type="button" name="send_button" value="send" onclick="send()">
  </p>
  <div id="nameInput">
    <p>name: <input id="sendName" type="text">
      <input type="button" name="sendName" value="Name" onclick="sendName()">
    </p>
  </div>
  <p> Your Cards:</p>
  <img id="card1" src="3C.svg" style="width:auto;">
  <img id="card2" src="3D.svg" style="width:auto;">
  <img id="card3" src="3H.svg" style="width:auto;">
  <img id="card4" src="4C.svg" style="width:auto;">
  <img id="card5" src="5C.svg" style="width:auto;">

  <input type="button" name="sendStand" value="Stand" onclick="sendEvent(1)">
  <p>Draw cards (gives the card numbers (ex: 1 2 3): <input id="send_index" type="text">
      <input type="button" name="sendDraw" value="Draw" onclick="sendEvent(2)">
  </p>
  <p>Bet: <input id="send_bet" type="text">
      <input type="button" name="sendBet" value="Bet" onclick="sendEvent(3)">
  </p>
  <input type="button" name="sendFold" value="Fold" onclick="sendEvent(4)">

  <div id="textbox"></div>
</body>

</html>
<script>

  var connection = null;

  var serverUrl;
  serverUrl ="ws://" + window.location.hostname + ":8880";

  connection = new WebSocket(serverUrl);
  connection.onopen = function (evt) {
    console.log("open");
  }

  var cardIdx = 0;
  var playerID = 0;

  connection.onmessage = function (evt) {
    var msg;
    msg = evt.data;

    console.log("Message received: ");
    document.getElementById("textbox").innerText = document.getElementById("textbox").innerText + '\n\n' + "Message Received" + "\n" + msg;

    // This is a hack for this example.
    // The only time the WebPoker server sends data just
    // to this client is at the beginging, when the connection
    // is first made.  The first communication tells us which
    // connection number we are, which is very import.
    // So, we detect this situation where it is not game state

    // Take the msg and turn it into a javascript object
    const obj = JSON.parse(msg);
    if (!obj.players) {

      playerID = obj.Id;
      console.log("player ID = " + playerID);
      document.getElementById("textbox").innerText =
        document.getElementById("textbox").innerText + '\n\n' + "Player ID is " + playerID;
    }
    else {

      // process the game state
      // this will just have one card change every time a new game state comes in.
      // the term LUT means "look up table".  you will see it sometimes in code written last
      // century.

      /*
      cardLUT = ["3C.svg", "2B.svg", "3S.svg", "KC.svg", "6D.svg", "2J.svg", "2S.svg"];

      document.getElementById("card4").src = cardLUT[cardIdx];
      cardIdx = cardIdx + 1;
      if (cardIdx > 6)
        cardIdx = 0;
        */

        // display the player's cards
        var player = obj.players[playerID];
        for(var i = 0; i < 5; i++)
        {
            var card = player.Cards[i];
            var str = "";
            if(card.value == "ACE")
                str += "A";
            else if(card.value == "TWO")
                str += "2";
            else if(card.value == "THREE")
                str += "3";
            else if(card.value == "FOUR")
                str += "4";
            else if(card.value == "FIVE")
                str += "5";
            else if(card.value == "SIX")
                str += "6";
            else if(card.value == "SEVEN")
                str += "7";
            else if(card.value == "EIGHT")
                str += "8";
            else if(card.value == "NINE")
                str += "9";
            else if(card.value == "TEN")
                str += "T";
            else if(card.value == "JACK")
                str += "J";
            else if(card.value == "QUEEN")
                str += "Q";
            else if(card.value == "KING")
                str += "K";

            if( card.suite.toString = "SPADES")
                str += "S";
            else if( card.suite.toString = "HEARTS")
                str += "H";
            else if( card.suite.toString = "CLUBS")
                str += "C";
            else if( card.suite.toString = "DIAMONDS")
                str += "D";

            str += ".svg";
            var number = i + 1;
            var cardnumber = "card" + number;
            document.getElementById(cardnumber).src = str;
        }
    }
    console.log("the cardIdx is " + cardIdx)
  }

  // send info from the buttons where
  // 1 is STAND
  // 2 is Draw
  // 3 is Bet
  // 4 is fold
  // passed as an argument from button
  function sendEvent(option)
  {
      // send a UserEvent in JSON
      var eventType;
      var amount = 0;
      var indexes = [-1,-1,-1];
      // event type is STAND
      if(option == 1)
      {
          eventType = "STAND";
      }
      // event type is DRAW
      else if(option == 2)
      {
          eventType = "DRAW";
          // get the indexes of the cards
          var str = document.getElementById("send_index").value;
          arr = str.split(' ');
          // can only get a max of 3 cards
          var max = 3;
          // verify no more than 3
          if(arr.length <= 3)
          {
              max = arr.length
          }
          for(var i = 0; i < max; i++)
          {
              // store the indexes as ints
              indexes[i] = parseInt(arr[i],10);
          }
      }
      // event type is BET
      else if(option == 3)
      {
          eventType = "BET";
          amount = parseInt(document.getElementById("send_bet").value,10);
      }
      // event type is BET
      else if(option == 4)
      {
          eventType = "FOLD";
      }

      // create the object to be sent to the game server
      const UserEvent = {
          event: eventType,
          playerID: playerID,
          name: document.getElementById("sendName").value,
          amount_to_bet: amount,
          give_card_indexes: indexes
      };
      connection.send(JSON.stringify(UserEvent));
      console.log(JSON.stringify(UserEvent));
  }

  function send() {

    var msg = {
      text: document.getElementById("send_text").value,
    };
    connection.send(JSON.stringify(msg));
    console.log(JSON.stringify(msg));
  }
  function sendName() {

    var msg = {
      event: "NAME",
      name: document.getElementById("sendName").value,
      playerID: playerID,
      amount_to_draw: 0,
      give_card_indexes: [-1,-1,-1]
    };
    connection.send(JSON.stringify(msg));
    console.log(JSON.stringify(msg));


    // this shows how to hid html elements.
    // like when the name is entered
    //  it might be better to hide after the server has accepted it
    // but this is just a demonstration

    var x = document.getElementById("nameInput");
    if (x.style.display === "none") {
      x.style.display = "block";
    } else {
      x.style.display = "none";
    }

  }

</script>
